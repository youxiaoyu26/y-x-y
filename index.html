<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>专为姐姐设计的网站！</title>
    <style>
        :root { --bg: #faf9f6; --main: #d4a373; --white: #ffffff; }
        body { background: var(--bg); font-family: sans-serif; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; }
        
        /* 导航 */
        header { 
            position: sticky; top: 0; width: 100%; height: 60px; 
            background: rgba(255,255,255,0.9); backdrop-filter: blur(10px);
            display: flex; justify-content: center; align-items: center; 
            border-bottom: 1px solid #eee; z-index: 100;
        }

        /* 主体 */
        .container { width: 100%; max-width: 500px; padding: 20px; box-sizing: border-box; }
        
        .input-box { background: #fff; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-top: 20px; }
        textarea { width: 100%; height: 80px; border: 1px solid #eee; border-radius: 10px; padding: 10px; box-sizing: border-box; outline: none; resize: none; font-size: 16px; }
        .btn { width: 100%; background: var(--main); color: white; border: none; padding: 12px; border-radius: 10px; margin-top: 10px; cursor: pointer; font-size: 16px; font-weight: bold; }
        .btn:disabled { background: #ccc; }

        /* 状态提示 */
        #status { text-align: center; color: var(--main); font-size: 14px; margin: 15px 0; min-height: 20px; }

        /* 列表 */
        .item { background: #fff; padding: 20px; border-radius: 15px; margin-bottom: 15px; border-left: 5px solid var(--main); box-shadow: 0 2px 5px rgba(0,0,0,0.02); animation: fadeIn 0.5s; }
        .time { font-size: 12px; color: #bbb; display: block; margin-bottom: 5px; }
        .txt { font-size: 16px; color: #444; white-space: pre-wrap; word-break: break-all; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <header><b style="color:var(--main)">专为姐姐设计的网站！</b></header>

    <div class="container">
        <div class="input-box">
            <textarea id="msgInp" placeholder="想对姐姐说点什么？内容会同步到云端..."></textarea>
            <button class="btn" id="postBtn" onclick="doPublish()">同步发布</button>
        </div>

        <div id="status">正在检查云端连接...</div>

        <div id="msgList"></div>
    </div>

    <script>
        // ================= 配置区 =================
        // 1. 填入你在 jsonbin.io 申请的 X-Master-Key
        const MASTER_KEY = "$2a$10$WvH0CTiBe.aiWMuITV2QdupmPD7WmxQDmFyfVSZ7BKUPCy6u.cu8S"; 
        
        // 2. 第一次运行成功后，把弹窗里的 ID 填在这里
        let BIN_ID = "这里填你获取到的ID"; 
        // ==========================================

        const statusEl = document.getElementById('status');
        const listEl = document.getElementById('msgList');

        // 初始化加载
        window.onload = async function() {
            if (MASTER_KEY.includes("$2a$10$WvH0CTiBe.aiWMuITV2QdupmPD7WmxQDmFyfVSZ7BKUPCy6u.cu8S")) {
                statusEl.innerHTML = "❌ 还没填 Master Key，请用记事本打开 HTML 修改第 130 行";
                return;
            }

            if (!BIN_ID || BIN_ID.includes("这里填")) {
                // 如果没有 ID，尝试自动创建一个
                statusEl.innerText = "正在为您创建专属云端空间...";
                await createNewBin();
            } else {
                // 如果有 ID，直接加载数据
                fetchData();
            }
        };

        // 创建新的云端文件
        async function createNewBin() {
            try {
                const res = await fetch("https://api.jsonbin.io/v3/b", {
                    method: 'POST',
                    headers: {
                        "Content-Type": "application/json",
                        "X-Master-Key": MASTER_KEY,
                        "X-Bin-Private": "true"
                    },
                    body: JSON.stringify({ notes: [{ content: "欢迎来到姐姐的秘密基地！", time: new Date().toLocaleString() }] })
                });
                const data = await res.json();
                const newId = data.metadata.id;
                statusEl.innerHTML = `✅ 空间创建成功！<br>请复制此 ID 并填入代码第 131 行：<br><b style="color:red">${newId}</b>`;
                alert("云端空间已创建！\n\n请复制接下来的 ID 并填回代码中：\n" + newId);
            } catch (e) {
                statusEl.innerText = "❌ 创建失败，请检查 Master Key 是否正确";
            }
        }

        // 获取云端数据并显示
        async function fetchData() {
            statusEl.innerText = "正在同步云端内容...";
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                    headers: { "X-Master-Key": MASTER_KEY, "Cache-Control": "no-cache" }
                });
                if (!res.ok) throw new Error();
                const result = await res.json();
                render(result.record.notes || []);
                statusEl.innerText = "✨ 云端同步完成";
            } catch (e) {
                statusEl.innerText = "❌ 读取失败，请检查 BIN_ID 是否填对";
            }
        }

        // 渲染到页面
        function render(notes) {
            listEl.innerHTML = '';
            // 倒序显示，最新的在上面
            [...notes].reverse().forEach(n => {
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `<span class="time">${n.time}</span><div class="txt">${n.content}</div>`;
                listEl.appendChild(div);
            });
        }

        // 发布新内容
        async function doPublish() {
            const inp = document.getElementById('msgInp');
            const btn = document.getElementById('postBtn');
            const content = inp.value.trim();
            if (!content) return;

            btn.disabled = true;
            statusEl.innerText = "正在向云端发送...";

            try {
                // 1. 先拿旧数据
                const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                    headers: { "X-Master-Key": MASTER_KEY }
                });
                const result = await res.json();
                let notes = result.record.notes || [];

                // 2. 加新数据
                notes.push({ content: content, time: new Date().toLocaleString() });

                // 3. 覆盖存回去
                await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                    method: 'PUT',
                    headers: { "Content-Type": "application/json", "X-Master-Key": MASTER_KEY },
                    body: JSON.stringify({ notes: notes })
                });

                inp.value = '';
                await fetchData(); // 重新刷新显示
            } catch (e) {
                alert("发布失败，请刷新重试");
            } finally {
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
