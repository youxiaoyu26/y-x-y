<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸“å±å‘Šç™½æµ‹è¯•</title>
    <style>
        :root {
            --primary-color: #ff4d6d;
            --radius: 15px;
            --speed: 0.6s;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Microsoft YaHei', sans-serif;
            background: #fdf2f4;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            transition: background 0.5s ease;
        }

        /* è®¾ç½®é¢æ¿ */
        .setup-container {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 320px;
            text-align: center;
            z-index: 100;
            position: relative;
        }

        .step { display: none; }
        .step.active { display: block; animation: fadeIn 0.4s; }

        @keyframes fadeIn { from { opacity:0; transform:scale(0.9); } to { opacity:1; transform:scale(1); } }

        h2 { color: var(--primary-color); font-size: 20px; }
        input, select {
            width: 100%; padding: 12px; margin: 10px 0;
            border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box;
        }
        
        button {
            width: 100%; background: var(--primary-color); color: white;
            border: none; padding: 12px; border-radius: 8px;
            cursor: pointer; font-weight: bold; margin-top: 10px;
        }

        /* å¼¹çª—æ ·å¼ */
        .love-popup {
            position: fixed;
            background: white;
            padding: 15px 20px;
            border: 2px solid var(--primary-color);
            box-shadow: 0 5px 15px rgba(255, 77, 109, 0.3);
            z-index: 50;
            min-width: 150px;
            text-align: center;
            pointer-events: none; /* é˜²æ­¢é®æŒ¡ç‚¹å‡» */
            transform: scale(0);
            transition: transform var(--speed) cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* çˆ±å¿ƒç‰¹æ•ˆ */
        .heart {
            position: fixed;
            color: var(--primary-color);
            font-size: 20px;
            user-select: none;
            z-index: 1;
            animation: heartUp 3s linear forwards;
        }
        @keyframes heartUp {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }

        #stop-btn {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            display: none; background: rgba(0,0,0,0.5); padding: 5px 15px;
            color: white; border-radius: 20px; font-size: 12px; z-index: 1000;
        }
    </style>
</head>
<body>

<div class="setup-container" id="panel">
    <div class="step active" id="s1">
        <h2>ğŸ’ è¾“å…¥ TA çš„åå­—</h2>
        <input type="text" id="targetName" placeholder="æ€ä¹ˆç§°å‘¼å¯¹æ–¹ï¼Ÿ">
        <button onclick="next(2)">ç»§ç»­</button>
    </div>
    <div class="step" id="s2">
        <h2>âœï¸ ä¸“å±ç¥ç¦è¯­</h2>
        <input type="text" id="userWish" placeholder="åœ¨è¿™é‡Œå†™ä¸‹ä½ çš„å‘Šç™½">
        <button style="background:#ffb3c1" onclick="randomWish()">éšæœºå®˜æ–¹ç¥ç¦</button>
        <button onclick="next(3)">ä¸‹ä¸€æ­¥</button>
    </div>
    <div class="step" id="s3">
        <h2>ğŸ¨ èƒŒæ™¯é£æ ¼</h2>
        <select id="bgSet" onchange="document.body.style.background=this.value">
            <option value="#fdf2f4">ç»å…¸ç²‰</option>
            <option value="#eef2ff">å¤©ç©ºè“</option>
            <option value="linear-gradient(to top, #fad0c4 0%, #ffd1ff 100%)">è½æ—¥éœ</option>
        </select>
        <button onclick="next(4)">ä¸‹ä¸€æ­¥</button>
    </div>
    <div class="step" id="s4">
        <h2>ğŸµ èƒŒæ™¯éŸ³ä¹ (URL)</h2>
        <input type="text" id="musicUrl" placeholder="MP3é“¾æ¥(å¯é€‰)">
        <button onclick="next(5)">ä¸‹ä¸€æ­¥</button>
    </div>
    <div class="step" id="s5">
        <h2>âš™ï¸ å¼¹çª—å‚æ•°</h2>
        <p style="font-size:12px; color:#666">é¢‘ç‡(ç§’): <input type="number" id="freq" value="0.5" step="0.1" style="width:60px"></p>
        <p style="font-size:12px; color:#666">åœ†è§’: <input type="range" id="rd" min="0" max="50" value="15" oninput="document.documentElement.style.setProperty('--radius', this.value+'px')"></p>
        <button onclick="launch()">å¼€å§‹è¡¨ç™½ï¼</button>
    </div>
</div>

<div id="stop-btn">ç‚¹å‡»å±å¹•ä»»ä½•ä½ç½®åœæ­¢</div>
<audio id="player" loop></audio>

<script>
    const officialWishes = ["æˆ‘çˆ±ä½ ", "ä½ æ˜¯æˆ‘å‘¼å¸çš„ç©ºæ°”", "æƒ³å’Œä½ è™šåº¦æ—¶å…‰", "é‡è§ä½ æ˜¯æˆ‘çš„ç¡®å¹¸", "çœ¼é‡Œåªæœ‰ä½ "];
    let timer = null;
    let heartTimer = null;

    function next(n) {
        document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
        document.getElementById('s' + n).classList.add('active');
    }

    function randomWish() {
        document.getElementById('userWish').value = officialWishes[Math.floor(Math.random()*officialWishes.length)];
    }

    // æ ¸å¿ƒå‘å°„å‡½æ•°
    function launch() {
        const name = document.getElementById('targetName').value || "äº²çˆ±çš„";
        const wish = document.getElementById('userWish').value || "æ¯ä¸€å¤©éƒ½æƒ³è§åˆ°ä½ ";
        const freq = parseFloat(document.getElementById('freq').value) * 1000;
        const music = document.getElementById('musicUrl').value;
        const radius = document.getElementById('rd').value + 'px';

        // æ’­æ”¾éŸ³ä¹
        if(music) {
            const p = document.getElementById('player');
            p.src = music;
            p.play().catch(() => console.log("éœ€æ‰‹åŠ¨ç‚¹å‡»æ’­æ”¾"));
        }

        // éšè—é¢æ¿
        document.getElementById('panel').style.display = 'none';
        document.getElementById('stop-btn').style.display = 'block';

        // è®¾ç½®å…¨å±€CSSå˜é‡
        document.documentElement.style.setProperty('--speed', (freq/1000) + 's');

        // 1. å¼€å¯å¼¹çª—å¾ªç¯
        timer = setInterval(() => {
            spawnPopup(name, wish, radius);
        }, freq);

        // 2. å¼€å¯çˆ±å¿ƒå¾ªç¯
        heartTimer = setInterval(spawnHeart, 300);
    }

    function spawnPopup(name, wish, radius) {
        const div = document.createElement('div');
        div.className = 'love-popup';
        div.style.borderRadius = radius;
        
        // éšæœºå†…å®¹ï¼šç”¨æˆ·è‡ªå®šä¹‰ä¸éšæœºç¥ç¦æ··æ’
        const content = Math.random() > 0.4 ? wish : officialWishes[Math.floor(Math.random()*officialWishes.length)];
        div.innerHTML = `<strong style="color:#ff4d6d">To ${name}:</strong><br>${content}`;
        
        // éšæœºä½ç½®
        const x = Math.random() * (window.innerWidth - 180);
        const y = Math.random() * (window.innerHeight - 80);
        div.style.left = x + 'px';
        div.style.top = y + 'px';

        document.body.appendChild(div);

        // å¼¹å‡ºåŠ¨ç”»
        setTimeout(() => div.style.transform = 'scale(1)', 50);

        // è‡ªåŠ¨ç§»é™¤
        setTimeout(() => {
            div.style.transform = 'scale(0)';
            setTimeout(() => div.remove(), 500);
        }, 3000);
    }

    function spawnHeart() {
        const h = document.createElement('div');
        h.className = 'heart';
        h.innerHTML = 'â¤';
        h.style.left = Math.random() * 100 + 'vw';
        h.style.bottom = '-20px';
        h.style.opacity = Math.random();
        h.style.fontSize = (Math.random() * 20 + 10) + 'px';
        document.body.appendChild(h);
        setTimeout(() => h.remove(), 3000);
    }

    // åœæ­¢é€»è¾‘
    document.addEventListener('click', (e) => {
        if (timer && e.target.tagName !== 'BUTTON') {
            clearInterval(timer);
            clearInterval(heartTimer);
            timer = null;
            alert("è½°ç‚¸å·²åœæ­¢ï¼Œä½†çˆ±æ„æ°¸å­˜ âœ¨");
        }
    });
</script>
</body>
</html>
