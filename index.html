<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸“ä¸ºå§å§è®¾è®¡çš„ç½‘ç«™ï¼</title>
    <style>
        :root { --bg: #faf9f6; --main: #d4a373; }
        body { background: var(--bg); font-family: sans-serif; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; }
        header { position: sticky; top: 0; width: 100%; height: 60px; background: #fff; display: flex; justify-content: center; align-items: center; border-bottom: 1px solid #eee; z-index: 100; }
        .container { width: 100%; max-width: 500px; padding: 20px; box-sizing: border-box; }
        
        /* å…³é”®æ˜¾ç¤ºåŒºåŸŸ */
        #status-board { 
            background: #fffbe6; border: 1px solid #ffe58f; padding: 15px; 
            border-radius: 10px; margin: 20px 0; text-align: center; color: #856404;
            font-size: 14px; line-height: 1.8;
        }
        .id-highlight { color: #f5222d; font-weight: bold; font-size: 18px; background: #fff; padding: 2px 8px; border: 1px dashed #f5222d; }

        .input-box { background: #fff; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        textarea { width: 100%; height: 80px; border: 1px solid #eee; border-radius: 10px; padding: 10px; box-sizing: border-box; outline: none; resize: none; font-size: 16px; }
        .btn { width: 100%; background: var(--main); color: white; border: none; padding: 12px; border-radius: 10px; margin-top: 10px; cursor: pointer; font-size: 16px; }
        
        .item { background: #fff; padding: 20px; border-radius: 15px; margin-top: 15px; border-left: 5px solid var(--main); box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .time { font-size: 12px; color: #bbb; display: block; }
        .txt { font-size: 16px; color: #444; margin-top: 10px; }
    </style>
</head>
<body>

    <header><b style="color:var(--main)">ä¸“ä¸ºå§å§è®¾è®¡çš„ç½‘ç«™ï¼</b></header>

    <div class="container">
        <div id="status-board">æ­£åœ¨è¿æ¥äº‘ç«¯ï¼Œè¯·ç¨å€™...</div>

        <div class="input-box">
            <textarea id="msgInp" placeholder="å†™ä¸‹æƒ³å¯¹å§å§è¯´çš„è¯..."></textarea>
            <button class="btn" id="postBtn" onclick="doPublish()">åŒæ­¥å‘å¸ƒ</button>
        </div>

        <div id="msgList"></div>
    </div>

    <script>
        // ======= 1. è¯·åœ¨è¿™é‡Œå¡«å…¥ä½ çš„ Master Key =======
        const MASTER_KEY = "$2a$10$lq61umlvFUgmbzVZts9WY.4brTae7F8gCucq2L47zNSOKa4WRKODO"; 
        
        // ======= 2. è·å–åˆ°IDåå¡«åœ¨è¿™é‡Œ =======
        let BIN_ID = "699c4b22ae596e708f424292"; 
        // ===========================================

        const board = document.getElementById('status-board');
        const listEl = document.getElementById('msgList');

        window.onload = async function() {
            if (MASTER_KEY.length < 10 || MASTER_KEY.includes("$2a$10$lq61umlvFUgmbzVZts9WY.4brTae7F8gCucq2L47zNSOKa4WRKODO")) {
                board.innerHTML = "ğŸ’¡ <b>ç¬¬ä¸€æ­¥ï¼š</b><br>è¯·å…ˆå» jsonbin.io ç”³è¯· Master Key å¹¶å¡«å…¥ä»£ç ç¬¬ 48 è¡Œã€‚";
                return;
            }

            if (!BIN_ID || BIN_ID.length < 10) {
                board.innerHTML = "â³ æ­£åœ¨ä¸ºæ‚¨åˆ›å»ºäº‘ç«¯ç©ºé—´...";
                autoCreateBin();
            } else {
                board.innerHTML = "âœ… äº‘ç«¯å·²è¿æ¥";
                fetchData();
            }
        };

        // è‡ªåŠ¨åˆ›å»º
        async function autoCreateBin() {
            try {
                const res = await fetch("https://api.jsonbin.io/v3/b", {
                    method: 'POST',
                    headers: {
                        "Content-Type": "application/json",
                        "X-Master-Key": MASTER_KEY,
                        "X-Bin-Private": "true"
                    },
                    body: JSON.stringify({ notes: [{ content: "äº‘ç«¯ç©ºé—´åˆ›å»ºæˆåŠŸï¼å¼€å§‹ç•™è¨€å§ã€‚", time: new Date().toLocaleString() }] })
                });
                const data = await res.json();
                if (data.metadata && data.metadata.id) {
                    const newId = data.metadata.id;
                    board.innerHTML = `ğŸ‰ <b>ç©ºé—´åˆ›å»ºæˆåŠŸï¼</b><br>è¯·å¤åˆ¶ä¸‹æ–¹ ID å¹¶å¡«å…¥ä»£ç ç¬¬ 51 è¡Œï¼š<br><span class="id-highlight">${newId}</span><br>å¡«å¥½ä¿å­˜åï¼Œåˆ·æ–°ç½‘é¡µå³å¯å¼€å§‹åŒæ­¥ã€‚`;
                }
            } catch (e) {
                board.innerHTML = "âŒ åˆ›å»ºå¤±è´¥ã€‚è¯·æ£€æŸ¥æ‚¨çš„ Master Key æ˜¯å¦å¡«é”™ï¼Œæˆ–è€…ç½‘ç»œæ˜¯å¦å¼€å¯ã€‚";
            }
        }

        // è·å–æ•°æ®
        async function fetchData() {
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                    headers: { "X-Master-Key": MASTER_KEY, "Cache-Control": "no-cache" }
                });
                const result = await res.json();
                render(result.record.notes || []);
            } catch (e) {
                board.innerHTML = "âŒ è¯»å–å¤±è´¥ã€‚è¯·æ£€æŸ¥ä»£ç ç¬¬ 51 è¡Œçš„ BIN_ID æ˜¯å¦æ­£ç¡®ã€‚";
            }
        }

        function render(notes) {
            listEl.innerHTML = '';
            [...notes].reverse().forEach(n => {
                const div = document.createElement('div');
                div.className = 'item';
                div.innerHTML = `<span class="time">${n.time}</span><div class="txt">${n.content}</div>`;
                listEl.appendChild(div);
            });
        }

        // å‘å¸ƒ
        async function doPublish() {
            if (!BIN_ID) { alert("è¯·å…ˆåœ¨ä»£ç ä¸­å¡«å…¥ BIN_IDï¼"); return; }
            const inp = document.getElementById('msgInp');
            const content = inp.value.trim();
            if (!content) return;

            document.getElementById('postBtn').disabled = true;
            board.innerHTML = "æ­£åœ¨åŒæ­¥åˆ°äº‘ç«¯...";

            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                    headers: { "X-Master-Key": MASTER_KEY }
                });
                const result = await res.json();
                let notes = result.record.notes || [];
                notes.push({ content: content, time: new Date().toLocaleString() });

                await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                    method: 'PUT',
                    headers: { "Content-Type": "application/json", "X-Master-Key": MASTER_KEY },
                    body: JSON.stringify({ notes: notes })
                });

                inp.value = '';
                board.innerHTML = "âœ… å‘å¸ƒæˆåŠŸ";
                fetchData();
            } catch (e) {
                alert("å‘å¸ƒå¤±è´¥");
            } finally {
                document.getElementById('postBtn').disabled = false;
            }
        }
    </script>
</body>
</html>
