<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å§å§çš„ä¸ªäººç½‘ç«™8.2.0</title>
    <style>
        :root { --main: #d4a373; --bg: #faf9f6; --white: #ffffff; }
        body { background: var(--bg); font-family: -apple-system, sans-serif; margin: 0; padding-top: 70px; }
        
        header { 
            position: fixed; top: 0; width: 100%; height: 60px; 
            background: rgba(255,255,255,0.9); backdrop-filter: blur(10px);
            display: flex; justify-content: space-between; align-items: center; 
            padding: 0 20px; box-sizing: border-box; z-index: 1000; border-bottom: 1px solid #eee;
        }
        .logo { color: var(--main); font-weight: bold; font-size: 1.1rem; }

        .menu-btn { cursor: pointer; border: none; background: none; display: flex; flex-direction: column; gap: 5px; padding: 10px; }
        .menu-btn span { width: 22px; height: 2px; background: var(--main); border-radius: 2px; }

        #sidePanel { 
            position: fixed; top: 0; right: -280px; width: 260px; height: 100%; 
            background: var(--white); z-index: 2000; transition: 0.3s; 
            padding: 40px 20px; box-sizing: border-box; box-shadow: -5px 0 15px rgba(0,0,0,0.05); 
            overflow-y: auto;
        }
        #sidePanel.open { right: 0; }
        .side-label { font-size: 11px; color: #ccc; margin: 20px 0 8px; display: block; text-transform: uppercase; border-bottom: 1px solid #f5f5f5; padding-bottom: 3px; }
        .side-info { font-size: 14px; color: #666; line-height: 1.6; margin-bottom: 5px; }
        .version-tag { font-size: 12px; color: var(--main); background: #fdf5eb; padding: 2px 8px; border-radius: 10px; font-weight: bold; }

        .auth-box { margin-top: 10px; padding: 15px; background: #fdfdfd; border: 1px solid #f0f0f0; border-radius: 12px; }
        .auth-input { width: 100%; padding: 8px; margin-bottom: 8px; border: 1px solid #eee; border-radius: 6px; box-sizing: border-box; font-size: 13px; outline: none; }
        .auth-input:focus { border-color: var(--main); }
        .input-hint { font-size: 10px; color: #aaa; margin-top: -5px; margin-bottom: 10px; display: block; line-height: 1.4; }
        .auth-btn { width: 100%; padding: 8px; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; margin-bottom: 5px; font-weight: bold; }
        .login-btn { background: var(--main); color: white; }
        .reg-link { font-size: 12px; color: #999; text-align: center; display: block; cursor: pointer; margin-top: 5px; }

        .container { max-width: 500px; margin: 0 auto; padding: 0 15px; }
        #status { font-size: 11px; color: #999; text-align: center; margin-bottom: 15px; min-height: 18px; }

        .input-card { background: #fff; padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); margin-bottom: 25px; }
        textarea { width: 100%; height: 80px; border: 1px solid #f0f0f0; border-radius: 10px; padding: 12px; box-sizing: border-box; font-size: 15px; outline: none; resize: none; background: #fdfdfd; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        .btn { border: none; border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-pub { flex: 4; background: var(--main); color: white; padding: 12px; font-size: 15px; }
        .btn-refresh { flex: 1; background: #eee; color: #666; font-size: 20px; }

        .card { background: #fff; padding: 18px; border-radius: 15px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.02); border-left: 4px solid var(--main); }
        .author-name { font-size: 13px; font-weight: bold; color: var(--main); margin-bottom: 4px; display: block; }
        .time { font-size: 10px; color: #ccc; margin-bottom: 8px; display: block; }
        .text { color: #444; font-size: 14px; line-height: 1.6; white-space: pre-wrap; }
        
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.2); display: none; z-index: 1999; }
        .rotating { animation: rotate 0.8s linear infinite; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <header>
        <div class="logo">å§å§çš„ä¸ªäººç½‘ç«™</div>
        <button class="menu-btn" onclick="toggleMenu()">
            <span></span><span></span><span></span>
        </button>
    </header>

    <div id="overlay" onclick="toggleMenu()"></div>

    <div id="sidePanel">
        <span class="side-label">ğŸ“¢ ç©ºé—´å…¬å‘Š</span>
        <div class="side-info">ç”¨æˆ·åå¦‚æœå·²ç»æœ‰äººä½¿ç”¨è¿‡åˆ™æ— æ³•å†æ¬¡ä½¿ç”¨å“¦ï¼</div>
        
        <span class="side-label">ğŸ‘¤ æ‹¥æœ‰è€…</span>
        <div class="side-info">äº²çˆ±çš„å§å§</div>

        <span class="side-label">VERSION</span>
        <span class="version-tag">v8.2.0 Stable</span>

        <span class="side-label">USER ACCOUNT</span>
        <div id="userSection" class="auth-box">
            <div id="loginForm">
                <input type="text" id="uName" class="auth-input" placeholder="ç”¨æˆ·å">
                <input type="password" id="uPass" class="auth-input" placeholder="å¯†ç ">
                <button class="auth-btn login-btn" onclick="handleAuth('login')">ç™»å½•</button>
                <span class="reg-link" onclick="toggleAuthMode(true)">æ²¡æœ‰è´¦å·ï¼Ÿå»æ³¨å†Œ</span>
            </div>
            <div id="regForm" style="display:none">
                <input type="text" id="rName" class="auth-input" placeholder="è®¾ç½®ç”¨æˆ·å (æœ€å¤š7å­—)">
                <input type="password" id="rPass" class="auth-input" placeholder="è®¾ç½®å¯†ç  (è‡³å°‘6ä½)">
                <span class="input-hint">è¦æ±‚ï¼šåå­—â‰¤7å­—ï¼›å¯†ç â‰¥6ä½ä¸”åŒ…å«æ‹¼éŸ³ä¸æ•°å­—</span>
                <button class="auth-btn login-btn" onclick="handleAuth('reg')">æ³¨å†Œå¹¶ç™»å½•</button>
                <span class="reg-link" onclick="toggleAuthMode(false)">å·²æœ‰è´¦å·ï¼Ÿè¿”å›ç™»å½•</span>
            </div>
            <div id="userInfo" style="display:none">
                <p style="font-size:14px; margin:0 0 10px">å½“å‰ç”¨æˆ·ï¼š<b id="currUser" style="color:var(--main)"></b></p>
                <button class="auth-btn" style="background:#eee; color:#666" onclick="logout()">é€€å‡ºç™»å½•</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div id="status">åŒæ­¥ä¸­...</div>
        <div class="input-card">
            <textarea id="msgInput" placeholder="æƒ³è¯´ä»€ä¹ˆï¼Ÿè¯·å…ˆç™»å½•..."></textarea>
            <div class="btn-group">
                <button class="btn btn-pub" onclick="publish()">å‘å¸ƒåŠ¨æ€</button>
                <button class="btn btn-refresh" onclick="loadData()"><span id="refreshIcon">â†»</span></button>
            </div>
        </div>
        <div id="msgList"></div>
    </div>

    <script>
        const CONFIG = {
            KEY: "$2a$10$RhcPZqRZZjdSWEp85cbSb.xngZSGZeda4a25br/od0U9pyqLcKBja", 
            BIN: "699c4b22ae596e708f424292"
        };

        let currentUser = localStorage.getItem('sister_user') || null;

        function toggleMenu() {
            const panel = document.getElementById('sidePanel');
            const isOpen = panel.classList.toggle('open');
            document.getElementById('overlay').style.display = isOpen ? 'block' : 'none';
            updateUserUI();
        }

        function toggleAuthMode(isReg) {
            document.getElementById('loginForm').style.display = isReg ? 'none' : 'block';
            document.getElementById('regForm').style.display = isReg ? 'block' : 'none';
        }

        function updateUserUI() {
            const info = document.getElementById('userInfo');
            const login = document.getElementById('loginForm');
            const reg = document.getElementById('regForm');
            if(currentUser) {
                info.style.display = 'block';
                login.style.display = reg.style.display = 'none';
                document.getElementById('currUser').innerText = currentUser;
            } else {
                info.style.display = 'none';
                login.style.display = 'block';
            }
        }

        async function handleAuth(type) {
            const status = document.getElementById('status');
            status.innerText = "æ­£åœ¨éªŒè¯...";
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN}/latest`, { headers: { "X-Master-Key": CONFIG.KEY }});
                const data = await res.json();
                let users = data.record.users || [];

                if(type === 'reg') {
                    const name = document.getElementById('rName').value.trim();
                    const pass = document.getElementById('rPass').value.trim();
                    
                    if(!name || !pass) return alert("è¯·å¡«å†™å®Œæ•´ä¿¡æ¯");
                    
                    // 1. åå­—é•¿åº¦é™åˆ¶ (ä¸è¶…è¿‡7å­—)
                    if(name.length > 7) {
                        return alert("ã€æ ¼å¼é”™è¯¯ã€‘åå­—å¤ªé•¿å•¦ï¼Œä¸èƒ½è¶…è¿‡ 7 ä¸ªå­—å“¦ï¼");
                    }

                    // 2. åå­—é‡å¤æ ¡éªŒ
                    if(users.some(u => u.name.toLowerCase() === name.toLowerCase())) {
                        return alert("ã€åå­—é‡å¤ã€‘è¿™ä¸ªåå­—å·²ç»è¢«å ç”¨äº†ï¼");
                    }

                    // 3. å¯†ç é•¿åº¦é™åˆ¶ (ä¸å°‘äº6ä½)
                    if(pass.length < 6) {
                        return alert("ã€æ ¼å¼é”™è¯¯ã€‘å¯†ç å¤ªçŸ­ï¼Œè‡³å°‘éœ€è¦ 6 ä¸ªå­—ç¬¦ï¼");
                    }

                    // 4. å¯†ç æ‹¼éŸ³+æ•°å­—è§„åˆ™æ ¡éªŒ
                    const hasLetter = /[a-zA-Z]/.test(pass);
                    const hasNumber = /[0-9]/.test(pass);
                    if(!hasLetter || !hasNumber) {
                        return alert("ã€æ ¼å¼é”™è¯¯ã€‘å¯†ç å¿…é¡»åŒæ—¶åŒ…å«æ‹¼éŸ³å­—æ¯å’Œæ•°å­—ï¼");
                    }

                    users.push({name, pass});
                    await saveToCloud({ ...data.record, users });
                    currentUser = name;
                    alert("æ³¨å†ŒæˆåŠŸï¼");
                } else {
                    const name = document.getElementById('uName').value.trim();
                    const pass = document.getElementById('uPass').value.trim();
                    const user = users.find(u => u.name === name && u.pass === pass);
                    if(!user) return alert("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
                    currentUser = name;
                }
                localStorage.setItem('sister_user', currentUser);
                updateUserUI();
                toggleMenu();
            } catch (e) { alert("è¿æ¥äº‘ç«¯å¤±è´¥"); }
        }

        function logout() {
            localStorage.removeItem('sister_user');
            currentUser = null;
            updateUserUI();
        }

        async function loadData() {
            const icon = document.getElementById('refreshIcon');
            if(icon) icon.classList.add('rotating');
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN}/latest?v=${Date.now()}`, {
                    headers: { "X-Master-Key": CONFIG.KEY }
                });
                const data = await res.json();
                render(data.record.notes || []);
                document.getElementById('status').innerText = "âœ¨ å·²åŒæ­¥æœ€æ–°åŠ¨æ€";
            } catch (e) { }
            setTimeout(() => { if(icon) icon.classList.remove('rotating'); }, 500);
        }

        function render(notes) {
            const list = document.getElementById('msgList');
            list.innerHTML = '';
            [...notes].reverse().forEach(note => {
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `<span class="author-name">ğŸ‘¤ ${note.author}</span><span class="time">${note.time}</span><div class="text">${note.content}</div>`;
                list.appendChild(div);
            });
        }

        async function publish() {
            if(!currentUser) return alert("è¯·å…ˆç™»å½•ï¼");
            const input = document.getElementById('msgInput');
            const content = input.value.trim();
            if (!content) return;
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN}/latest`, { headers: { "X-Master-Key": CONFIG.KEY }});
                const data = await res.json();
                let notes = data.record.notes || [];
                notes.push({ author: currentUser, content: content, time: new Date().toLocaleString('zh-CN', { hour12: false }) });
                await saveToCloud({ ...data.record, notes });
                input.value = '';
                loadData();
            } catch (e) { alert("å‘å¸ƒå¤±è´¥"); }
        }

        async function saveToCloud(fullData) {
            return fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN}`, {
                method: 'PUT',
                headers: { "Content-Type": "application/json", "X-Master-Key": CONFIG.KEY, "X-Bin-Versioning": "false" },
                body: JSON.stringify(fullData)
            });
        }

        window.onload = () => { updateUserUI(); loadData(); };
    </script>
</body>
</html>
