<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å§å§çš„ä¸ªäººç©ºé—´</title>
    <style id="dynamicStyle">
        :root { 
            --main: #d4a373; 
            --bg: #faf9f6; 
            --radius: 12px; 
            --font: -apple-system, sans-serif;
            --effect-color: #d4a373;
            --effect-size: 30px;
            --effect-shape: circle;
        }
        body { 
            background: var(--bg); 
            font-family: var(--font); 
            margin: 0; padding-top: 65px; 
            background-size: cover; background-position: center; background-attachment: fixed; 
            transition: 0.3s; 
            position: relative;
            min-height: 100vh;
        }
        /* ç‚¹å‡»ç‰¹æ•ˆç”»å¸ƒ */
        #clickCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }
        header { position: fixed; top: 0; width: 100%; height: 55px; background: rgba(255,255,255,0.85); backdrop-filter: blur(10px); display: flex; justify-content: space-between; align-items: center; padding: 0 15px; box-sizing: border-box; z-index: 1000; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .logo { color: var(--main); font-weight: bold; font-size: 1rem; }
        .menu-btn { cursor: pointer; border: none; background: none; display: flex; flex-direction: column; gap: 4px; padding: 10px; }
        .menu-btn span { width: 20px; height: 2px; background: var(--main); border-radius: 2px; }

        /* ä¾§è¾¹æ ä¸å…¬å‘Š */
        #sidePanel { position: fixed; top: 0; right: -300px; width: 280px; height: 100%; background: #fff; z-index: 2000; transition: 0.3s; padding: 25px 20px; box-sizing: border-box; box-shadow: -5px 0 15px rgba(0,0,0,0.05); overflow-y: auto; }
        #sidePanel.open { right: 0; }
        .side-label { font-size: 10px; color: #bbb; margin: 15px 0 8px; display: block; text-transform: uppercase; border-bottom: 1px solid #f5f5f5; padding-bottom: 3px; }
        .ver-badge { background: var(--main); color: white; padding: 1px 5px; border-radius: 4px; font-size: 9px; margin-bottom: 3px; display: inline-block; }
        .notice-content { font-size: 12.5px; color: #444; line-height: 1.5; }
        
        /* ç½‘ç«™æ‹¥æœ‰è€…æ ·å¼ */
        .owner-section {
            background: rgba(212, 163, 115, 0.08);
            border-left: 2px solid var(--main);
            padding: 12px 12px;
            margin: 15px 0 15px 0;
            border-radius: 8px;
            font-size: 13px;
        }
        .owner-label {
            font-size: 10px;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        .owner-name {
            font-weight: bold;
            color: var(--main);
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .owner-badge {
            background: var(--main);
            color: white;
            font-size: 8px;
            padding: 2px 5px;
            border-radius: 20px;
            letter-spacing: 0.5px;
        }

        /* ç™»å½•æ¡†å¢å¼º */
        .login-hint { font-size: 10px; color: #999; margin: 4px 0 8px; display: block; }
        .auth-buttons {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        .auth-btn {
            flex: 1;
            background: var(--main);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px;
            font-size: 12px;
            cursor: pointer;
        }
        .register-btn {
            flex: 1;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px;
            font-size: 12px;
            cursor: pointer;
        }
        .register-btn:hover {
            background: #5a6268;
        }
        .auth-error {
            background: #ffebee;
            color: #c62828;
            font-size: 11px;
            padding: 6px 8px;
            border-radius: 4px;
            margin-top: 8px;
            border-left: 2px solid #c62828;
            display: none;
        }

        /* ä¸ªäººç­¾åæ ·å¼ */
        .signature-section {
            background: #f9f9f9;
            padding: 15px 12px;
            margin: 15px 0 15px 0;
            border-radius: 10px;
            border: 1px solid #eee;
        }
        .signature-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .signature-label {
            font-size: 11px;
            color: var(--main);
            font-weight: bold;
            letter-spacing: 0.5px;
        }
        .signature-owner-badge {
            background: rgba(212, 163, 115, 0.15);
            color: var(--main);
            font-size: 8px;
            padding: 2px 8px;
            border-radius: 20px;
            margin-left: 5px;
            border: 1px solid rgba(212, 163, 115, 0.3);
        }
        .signature-edit-btn {
            background: var(--main);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 3px 10px;
            font-size: 9px;
            cursor: pointer;
            opacity: 0.8;
            transition: 0.2s;
        }
        .signature-edit-btn:hover {
            opacity: 1;
        }
        .signature-display {
            font-size: 13px;
            color: #444;
            line-height: 1.5;
            word-break: break-word;
            background: white;
            padding: 8px 10px;
            border-radius: 8px;
            border: 1px solid #f0f0f0;
            min-height: 36px;
        }
        .signature-edit-area {
            display: none;
            margin-top: 8px;
        }
        .signature-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 12px;
            box-sizing: border-box;
            resize: vertical;
            min-height: 60px;
            font-family: inherit;
        }
        .signature-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        .signature-save {
            flex: 1;
            background: var(--main);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px;
            font-size: 11px;
            cursor: pointer;
        }
        .signature-cancel {
            flex: 1;
            background: #eee;
            color: #666;
            border: none;
            border-radius: 6px;
            padding: 6px;
            font-size: 11px;
            cursor: pointer;
        }

        /* åŠ¨æ€å¡ç‰‡ - å¢åŠ åŠ¨æ€åˆ é™¤æŒ‰é’® */
        .card { 
            background: rgba(255,255,255,0.9); 
            padding: 12px 15px; 
            margin-bottom: 12px; 
            border-left: 3px solid var(--main); 
            box-shadow: 0 2px 8px rgba(0,0,0,0.02);
            position: relative;
        }
        .card-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 6px; 
        }
        .card-header-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .author-name { 
            font-size: 11.5px; 
            color: var(--main); 
            font-weight: bold; 
        }
        .post-time { 
            font-size: 9px; 
            color: #ccc; 
        }
        .post-delete-btn {
            color: #ff4d4d;
            cursor: pointer;
            font-size: 14px;
            opacity: 0.6;
            transition: 0.2s;
            padding: 0 4px;
        }
        .post-delete-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }
        .post-text { 
            color: #444; 
            font-size: 13.5px; 
            line-height: 1.45; 
            white-space: pre-wrap; 
            margin-bottom: 8px; 
        }

        /* æŒ‰é’®å¹¶æ’ */
        .action-bar { display: flex; border-top: 1px solid #fcfcfc; padding-top: 8px; }
        .action-btn { flex: 1; font-size: 11px; color: var(--main); cursor: pointer; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 4px; padding: 4px 0; }
        .action-btn:first-child { border-right: 1px solid #f5f5f5; }

        /* å¸ƒå±€å®¹å™¨ */
        .container { max-width: 480px; margin: 0 auto; padding: 0 12px; }
        #status { font-size: 10px; color: #999; text-align: center; margin-bottom: 10px; height: 14px; }
        .input-card { background: rgba(255,255,255,0.9); padding: 15px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); }
        textarea { width: 100%; height: 60px; border: 1px solid #f0f0f0; padding: 10px; box-sizing: border-box; font-size: 14px; outline: none; resize: none; background: #fdfdfd; }
        
        .btn { border: none; cursor: pointer; font-weight: bold; transition: 0.2s; border-radius: var(--radius); }
        /* å‘å¸ƒåŒºåŸŸæŒ‰é’®ç»„ */
        .btn-group {
            display: flex;
            gap: 5%;
            margin-top: 8px;
        }
        .btn-pub { 
            flex: 0 0 75%; 
            background: var(--main); 
            color: white; 
            padding: 10px; 
            font-size: 14px; 
            box-sizing: border-box;
        }
        .btn-refresh { 
            flex: 0 0 20%; 
            background: rgba(0,0,0,0.05); 
            color: #666; 
            font-size: 18px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            box-sizing: border-box;
        }

        /* è¯„è®ºåŒºåŸŸ - åˆ é™¤æŒ‰é’®æ ·å¼ */
        .comment-item {
            background: rgba(0,0,0,0.02);
            padding: 8px 10px;
            margin-top: 4px;
            font-size: 11px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .comment-content {
            flex: 1;
        }
        .comment-actions {
            display: flex;
            gap: 6px;
            align-items: center;
        }
        .comment-like {
            color: var(--main);
            cursor: pointer;
            font-size: 10px;
            display: flex;
            align-items: center;
            gap: 2px;
        }
        .comment-delete {
            color: #ff4d4d;
            cursor: pointer;
            font-size: 12px;
            opacity: 0.6;
            transition: 0.2s;
            padding: 0 4px;
        }
        .comment-delete:hover {
            opacity: 1;
            transform: scale(1.1);
        }
        .comment-input-group {
            display: flex;
            gap: 5%;
            margin-top: 6px;
            align-items: center;
        }
        .comment-input-field {
            flex: 0 0 75%;
            padding: 4px;
            font-size: 11px;
            border: 1px solid #eee;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .comment-send-btn {
            flex: 0 0 20%;
            background: var(--main);
            color: white;
            padding: 4px 0;
            font-size: 10px;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: bold;
            box-sizing: border-box;
            text-align: center;
        }

        /* å¼€å‘è€…æ¨¡å¼ - ç‚¹å‡»ç‰¹æ•ˆè®¾ç½® */
        .effect-preview {
            width: 100%;
            height: 50px;
            background: #f5f5f5;
            border-radius: 8px;
            margin-top: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        .effect-preview-shape {
            width: var(--preview-size, 30px);
            height: var(--preview-size, 30px);
            background: var(--preview-color, #d4a373);
            border-radius: var(--preview-radius, 50%);
            animation: previewPulse 1.5s infinite;
        }
        @keyframes previewPulse {
            0% { transform: scale(0.8); opacity: 0.8; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(0.8); opacity: 0.8; }
        }
        .shape-selector {
            display: flex;
            gap: 10px;
            margin: 8px 0;
        }
        .shape-option {
            flex: 1;
            padding: 6px;
            text-align: center;
            background: #f0f0f0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            transition: 0.2s;
        }
        .shape-option.selected {
            background: var(--main);
            color: white;
        }

        #devModal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 380px; background: white; z-index: 3000; padding: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.2); max-height: 85vh; overflow-y: auto; display: none; border-radius: 20px; }
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); display: none; z-index: 1999; backdrop-filter: blur(4px); }
        
        .rotating { animation: rotate 0.8s linear infinite; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .card, .input-card, .btn, .notice-box { border-radius: var(--radius) !important; }

        /* åˆ é™¤ç¡®è®¤å¼¹çª—æ ·å¼ - ç›´æ¥å†™åœ¨é¡µé¢å†… */
        .delete-confirm-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        .delete-confirm-box {
            background: white;
            padding: 20px;
            border-radius: 12px;
            width: 260px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .delete-confirm-box p {
            margin: 0 0 20px 0;
            font-size: 14px;
            color: #333;
        }
        .delete-confirm-buttons {
            display: flex;
            gap: 10px;
        }
        .delete-confirm-btn {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
        }
        .delete-confirm-btn.yes {
            background: #ff4d4d;
            color: white;
        }
        .delete-confirm-btn.no {
            background: #f0f0f0;
            color: #666;
        }
    </style>
</head>
<body>

    <!-- ç‚¹å‡»ç‰¹æ•ˆç”»å¸ƒ -->
    <canvas id="clickCanvas"></canvas>

    <!-- åˆ é™¤ç¡®è®¤å¼¹çª—å®¹å™¨ - åŠ¨æ€ç”Ÿæˆ -->
    <div id="deleteConfirmContainer"></div>

    <header>
        <div class="logo">å§å§çš„ä¸ªäººç©ºé—´</div>
        <button class="menu-btn" onclick="toggleMenu()"><span></span><span></span><span></span></button>
    </header>

    <div id="overlay" onclick="closeAll()"></div>

    <div id="sidePanel">
        <span class="side-label">ğŸ“¢ å…¬å‘Šæ </span>
        <div id="currentNotice">
            <span class="ver-badge" id="verDisplay">v10.0.0</span>
            <div class="notice-content" id="noticeText">åŠ è½½ä¸­...</div>
        </div>

        <span style="font-size:11px; color:var(--main); cursor:pointer; margin-top:8px; display:block" onclick="toggleHistory()">å†å²æ›´æ–°è®°å½• â†“</span>
        <div id="historyBox" style="display:none; margin-top:10px; border-top:1px dashed #eee; padding-top:8px"></div>

        <!-- ç½‘ç«™æ‹¥æœ‰è€…ä¿¡æ¯ -->
        <div class="owner-section">
            <div class="owner-label">ğŸ‘‘ ç½‘ç«™æ‹¥æœ‰è€…</div>
            <div class="owner-name">
                é¥­é¥­ <span class="owner-badge">åˆ›å§‹äºº/æŸšå°å±¿</span>
            </div>
            <div style="font-size: 11px; color: #666; margin-top: 5px;">âœ¨ è®°å½•ç”Ÿæ´»ï¼Œåˆ†äº«ç¾å¥½</div>
        </div>

        <span class="side-label">ğŸ‘¤ è®¿å®¢ç™»å½•/æ³¨å†Œ</span>
        <div id="userSection" style="background:#f9f9f9; padding:12px; border-radius:10px; border:1px solid #eee">
            <div id="loginForm">
                <input type="text" id="uName" style="width:100%; padding:6px; border-radius:6px; border:1px solid #ddd; font-size:12px; box-sizing:border-box" placeholder="ä½ çš„æ˜µç§°">
                <input type="password" id="uPass" style="width:100%; padding:6px; border-radius:6px; border:1px solid #ddd; font-size:12px; margin-top:6px; box-sizing:border-box" placeholder="å¯†ç ">
                <span class="login-hint">ğŸ”’ å¯†ç ä¸èƒ½å°‘äº 6 ä¸ªå­—ç¬¦</span>
                <div id="authError" class="auth-error"></div>
                <div class="auth-buttons">
                    <button class="auth-btn" onclick="handleLogin()">ç™»å½•</button>
                    <button class="register-btn" onclick="handleRegister()">æ³¨å†Œ</button>
                </div>
            </div>
            <div id="userInfo" style="display:none">
                <span style="font-size:12px">æ¬¢è¿ï¼Œ<b id="currUser" style="color:var(--main)"></b></span>
                <button class="btn" style="background:#eee; font-size:10px; padding:2px 8px; margin-left:5px" onclick="logout()">æ³¨é”€</button>
            </div>
        </div>

        <!-- ä¸ªäººç­¾ååŒºåŸŸ -->
        <div class="signature-section">
            <div class="signature-header">
                <span class="signature-label">
                    ğŸ“ ä¸ªäººç­¾å 
                    <span id="signatureOwner" class="signature-owner-badge">æœªç™»å½•</span>
                </span>
                <button class="signature-edit-btn" onclick="toggleSignatureEdit()">ç¼–è¾‘</button>
            </div>
            <div id="signatureDisplay" class="signature-display">åŠ è½½ä¸­...</div>
            <div id="signatureEditArea" class="signature-edit-area">
                <textarea id="signatureInput" class="signature-input" placeholder="å†™ä¸€å¥ä½ çš„ä¸ªäººç­¾å..."></textarea>
                <div class="signature-actions">
                    <button class="signature-save" onclick="saveSignature()">ä¿å­˜åˆ°äº‘ç«¯</button>
                    <button class="signature-cancel" onclick="cancelSignatureEdit()">å–æ¶ˆ</button>
                </div>
            </div>
        </div>

        <button class="btn" style="background:#444; color:white; width:100%; margin-top:15px; padding:8px; font-size:12px" onclick="showDevAuth()">ğŸ› ï¸ å¼€å‘è€…æ¨¡å¼</button>
        <div id="devAuthArea" style="display:none; margin-top:8px">
            <input type="password" id="devPassInput" style="width:100%; padding:6px; border-radius:6px; border:1px solid #ddd; box-sizing:border-box" placeholder="å£ä»¤">
            <button class="btn btn-pub" style="width:100%; margin-top:5px; padding:6px" onclick="verifyDevPass()">ç¡®è®¤è¿›å…¥</button>
        </div>
    </div>

    <div id="devModal">
        <h3 style="margin:0 0 15px; text-align:center; font-size:16px">ğŸ› ï¸ å¼€å‘è€…é…ç½®</h3>
        
        <!-- å…¬å‘Šæ›´æ–°åŒºåŸŸ -->
        <div style="background:#f0f7ff; padding:10px; border-radius:10px; margin-bottom:15px">
            <label style="font-size:11px; font-weight:bold">å…¬å‘Šæ›´æ–°</label>
            <input type="text" id="devVer" style="width:100%; margin-top:4px; padding:5px; font-size:12px; box-sizing:border-box" placeholder="ç‰ˆæœ¬å·">
            <textarea id="devNotice" style="width:100%; height:40px; margin-top:4px; padding:5px; font-size:12px; box-sizing:border-box" placeholder="å†…å®¹..."></textarea>
        </div>

        <!-- ç‚¹å‡»ç‰¹æ•ˆè®¾ç½®åŒºåŸŸ -->
        <div style="background:#fff3e0; padding:10px; border-radius:10px; margin-bottom:15px">
            <label style="font-size:11px; font-weight:bold">âœ¨ ç‚¹å‡»ç‰¹æ•ˆè®¾ç½®</label>
            
            <!-- ç‰¹æ•ˆé¢œè‰² -->
            <div style="margin-top:8px">
                <label style="font-size:10px; color:#666">ç‰¹æ•ˆé¢œè‰²</label>
                <input type="color" id="effectColor" style="width:100%; height:35px; margin-top:4px" value="#d4a373">
            </div>
            
            <!-- ç‰¹æ•ˆå¤§å° -->
            <div style="margin-top:8px">
                <label style="font-size:10px; color:#666">ç‰¹æ•ˆå¤§å°: <span id="effectSizeVal">30px</span></label>
                <input type="range" id="effectSize" min="10" max="60" value="30" style="width:100%">
            </div>
            
            <!-- ç‰¹æ•ˆå½¢çŠ¶é€‰æ‹© -->
            <div style="margin-top:8px">
                <label style="font-size:10px; color:#666">ç‰¹æ•ˆå½¢çŠ¶</label>
                <div class="shape-selector" id="shapeSelector">
                    <div class="shape-option selected" data-shape="circle" onclick="selectShape('circle')">âšª åœ†å½¢</div>
                    <div class="shape-option" data-shape="square" onclick="selectShape('square')">â¬› æ–¹å½¢</div>
                    <div class="shape-option" data-shape="triangle" onclick="selectShape('triangle')">ğŸ”º ä¸‰è§’å½¢</div>
                </div>
            </div>
            
            <!-- ç‰¹æ•ˆé¢„è§ˆ -->
            <div style="margin-top:8px">
                <label style="font-size:10px; color:#666">å®æ—¶é¢„è§ˆ</label>
                <div class="effect-preview" id="effectPreview">
                    <div class="effect-preview-shape" id="previewShape"></div>
                </div>
            </div>
        </div>

        <!-- ä¸»é¢˜è®¾ç½®åŒºåŸŸ -->
        <div style="background:#f0f0f0; padding:10px; border-radius:10px; margin-bottom:15px">
            <label style="font-size:11px; font-weight:bold">ğŸ¨ ä¸»é¢˜è®¾ç½®</label>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px; margin-top:8px">
                <div><label style="font-size:11px">ä¸»è‰²</label><input type="color" id="themeColor" style="width:100%"></div>
                <div><label style="font-size:11px">èƒŒæ™¯è‰²</label><input type="color" id="bgColor" style="width:100%"></div>
            </div>
            <div style="margin-top:8px"><label style="font-size:11px">èƒŒæ™¯å›¾ URL</label><input type="text" id="bgUrl" style="width:100%; padding:5px; font-size:12px; box-sizing:border-box"></div>
            <div style="margin-top:8px">
                <label style="font-size:11px">UI åœ†è§’: <span id="radiusVal">12px</span></label>
                <input type="range" id="radiusRange" min="0" max="25" style="width:100%">
            </div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div style="display:flex; flex-direction:column; gap:6px; margin-top:15px">
            <button class="btn btn-pub" onclick="saveSettingsToCloud()">åŒæ­¥å‘å¸ƒ</button>
            <button class="btn" style="background:#ff4d4d; color:white; padding:8px" onclick="resetSettings()">é‡ç½®è£…ä¿®</button>
            <button class="btn" style="background:#eee; padding:8px" onclick="closeAll()">å–æ¶ˆ</button>
        </div>
    </div>

    <div class="container">
        <div id="status">è¿æ¥ä¸­...</div>
        <div class="input-card">
            <textarea id="msgInput" placeholder="åœ¨æ­¤åˆ†äº«ä½ çš„åŠ¨æ€..."></textarea>
            <div class="btn-group">
                <button class="btn btn-pub" onclick="publish()">å‘å¸ƒ</button>
                <button class="btn btn-refresh" onclick="loadData()"><span id="refreshIcon">â†»</span></button>
            </div>
        </div>
        <div id="msgList"></div>
    </div>

    <script>
        const CONFIG = {
            KEY: "$2a$10$RhcPZqRZZjdSWEp85cbSb.xngZSGZeda4a25br/od0U9pyqLcKBja", 
            BIN: "699c4b22ae596e708f424292",
            DEV_PASS: "ä½œè€…æœ€å¸…"
        };
        const DEFAULT_S = { 
            theme: "#d4a373", 
            bgCol: "#faf9f6", 
            bgImg: "", 
            font: "-apple-system, sans-serif", 
            radius: 12, 
            currentVer: "v1.0", 
            notice: "æ¬¢è¿å…‰ä¸´ï¼", 
            history: [],
            effect: {
                color: "#d4a373",
                size: 30,
                shape: "circle"
            }
        };
        let currentUser = localStorage.getItem('sister_user') || null;
        let currentSignature = "âœ¨ è¿™ä¸ªäººå¾ˆæ‡’ï¼Œè¿˜æ²¡æœ‰ç­¾å~";
        let signatureOwner = null;
        let users = [];
        let effectSettings = { color: "#d4a373", size: 30, shape: "circle" };
        let particles = [];

        // æ˜¾ç¤ºè‡ªå®šä¹‰åˆ é™¤ç¡®è®¤å¼¹çª—
        function showDeleteConfirm(message, onConfirm) {
            const container = document.getElementById('deleteConfirmContainer');
            container.innerHTML = `
                <div class="delete-confirm-overlay">
                    <div class="delete-confirm-box">
                        <p>${message}</p>
                        <div class="delete-confirm-buttons">
                            <button class="delete-confirm-btn yes" onclick="this.closest('.delete-confirm-overlay').remove(); ${onConfirm}">ç¡®å®š</button>
                            <button class="delete-confirm-btn no" onclick="this.closest('.delete-confirm-overlay').remove()">å–æ¶ˆ</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // ç‚¹å‡»ç‰¹æ•ˆç³»ç»Ÿ
        class Particle {
            constructor(x, y, color, size, shape) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.size = size;
                this.shape = shape;
                this.age = 0;
                this.maxAge = 30;
                this.vx = (Math.random() - 0.5) * 4;
                this.vy = (Math.random() - 0.5) * 4 - 2;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.1;
                this.age++;
                return this.age < this.maxAge;
            }

            draw(ctx) {
                const opacity = 1 - (this.age / this.maxAge);
                ctx.globalAlpha = opacity;
                ctx.fillStyle = this.color;
                
                const currentSize = this.size * (1 - this.age / this.maxAge * 0.5);
                
                ctx.beginPath();
                if (this.shape === 'circle') {
                    ctx.arc(this.x, this.y, currentSize / 2, 0, Math.PI * 2);
                    ctx.fill();
                } else if (this.shape === 'square') {
                    ctx.fillRect(this.x - currentSize/2, this.y - currentSize/2, currentSize, currentSize);
                } else if (this.shape === 'triangle') {
                    ctx.moveTo(this.x, this.y - currentSize/2);
                    ctx.lineTo(this.x - currentSize/2, this.y + currentSize/2);
                    ctx.lineTo(this.x + currentSize/2, this.y + currentSize/2);
                    ctx.closePath();
                    ctx.fill();
                }
                ctx.globalAlpha = 1;
            }
        }

        // åˆå§‹åŒ–ç‚¹å‡»ç‰¹æ•ˆ
        function initClickEffect() {
            const canvas = document.getElementById('clickCanvas');
            const ctx = canvas.getContext('2d');
            
            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);

            document.addEventListener('click', (e) => {
                // å¦‚æœç‚¹å‡»çš„æ˜¯å¼€å‘è€…æ¨¡å¼ç›¸å…³å…ƒç´ ï¼Œä¸äº§ç”Ÿç‰¹æ•ˆ
                if (e.target.closest('#devModal') || e.target.closest('#sidePanel') || e.target.closest('.btn')) {
                    return;
                }
                
                // æ¯æ¬¡ç‚¹å‡»äº§ç”Ÿ5-8ä¸ªç²’å­
                const particleCount = 5 + Math.floor(Math.random() * 4);
                for (let i = 0; i < particleCount; i++) {
                    particles.push(new Particle(
                        e.clientX, 
                        e.clientY, 
                        effectSettings.color,
                        effectSettings.size,
                        effectSettings.shape
                    ));
                }
            });

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                particles = particles.filter(p => p.update());
                particles.forEach(p => p.draw(ctx));
                requestAnimationFrame(animate);
            }
            animate();
        }

        // é€‰æ‹©ç‰¹æ•ˆå½¢çŠ¶
        function selectShape(shape) {
            document.querySelectorAll('.shape-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // æ›´æ–°é¢„è§ˆ
            updatePreview();
        }

        // æ›´æ–°é¢„è§ˆ
        function updatePreview() {
            const color = document.getElementById('effectColor').value;
            const size = document.getElementById('effectSize').value;
            const shape = document.querySelector('.shape-option.selected')?.dataset.shape || 'circle';
            
            const preview = document.getElementById('previewShape');
            preview.style.setProperty('--preview-color', color);
            preview.style.setProperty('--preview-size', size + 'px');
            
            if (shape === 'circle') {
                preview.style.borderRadius = '50%';
                preview.style.background = color;
                preview.style.border = 'none';
                preview.style.width = size + 'px';
                preview.style.height = size + 'px';
            } else if (shape === 'square') {
                preview.style.borderRadius = '0';
                preview.style.background = color;
                preview.style.border = 'none';
                preview.style.width = size + 'px';
                preview.style.height = size + 'px';
            } else if (shape === 'triangle') {
                preview.style.borderRadius = '0';
                preview.style.width = '0';
                preview.style.height = '0';
                preview.style.borderLeft = size/2 + 'px solid transparent';
                preview.style.borderRight = size/2 + 'px solid transparent';
                preview.style.borderBottom = size + 'px solid ' + color;
                preview.style.background = 'transparent';
            }
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showAuthError(message) {
            const errorDiv = document.getElementById('authError');
            errorDiv.style.display = 'block';
            errorDiv.innerText = message;
        }

        function hideAuthError() {
            const errorDiv = document.getElementById('authError');
            errorDiv.style.display = 'none';
            errorDiv.innerText = '';
        }

        async function loadUsers() {
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN}/latest?v=${Date.now()}`, { 
                    headers: { "X-Master-Key": CONFIG.KEY }
                });
                const d = await res.json();
                if (d.record.users) {
                    users = d.record.users;
                } else {
                    users = [];
                }
                return users;
            } catch (e) {
                console.error('åŠ è½½ç”¨æˆ·å¤±è´¥', e);
                return [];
            }
        }

        async function saveUsers(updatedUsers) {
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN}/latest`, { 
                    headers: { "X-Master-Key": CONFIG.KEY }
                });
                const data = await res.json();
                
                const updatedRecord = {
                    ...data.record,
                    users: updatedUsers
                };
                
                await updateCloud(updatedRecord);
                return true;
            } catch (e) {
                console.error('ä¿å­˜ç”¨æˆ·å¤±è´¥', e);
                return false;
            }
        }

        async function handleRegister() {
            hideAuthError();
            
            const n = document.getElementById('uName').value.trim();
            const p = document.getElementById('uPass').value;

            if(!n) { 
                showAuthError("è¯·è¾“å…¥æ˜µç§°"); 
                return; 
            }
            if(p.length < 6) { 
                showAuthError("å¯†ç ä¸èƒ½å°‘äº 6 ä¸ªå­—ç¬¦"); 
                return; 
            }
            
            await loadUsers();
            
            const existingUser = users.find(u => u.username === n);
            if (existingUser) {
                showAuthError("âŒ ç”¨æˆ·åå·²å­˜åœ¨ï¼Œè¯·ç›´æ¥ç™»å½•æˆ–ä½¿ç”¨å…¶ä»–æ˜µç§°");
                return;
            }
            
            users.push({
                username: n,
                password: p,
                createdAt: new Date().toISOString()
            });
            
            const success = await saveUsers(users);
            
            if (success) {
                showAuthError("âœ… æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•");
                document.getElementById('uPass').value = '';
            } else {
                showAuthError("âŒ æ³¨å†Œå¤±è´¥ï¼Œè¯·é‡è¯•");
            }
        }

        async function handleLogin() {
            hideAuthError();
            
            const n = document.getElementById('uName').value.trim();
            const p = document.getElementById('uPass').value;

            if(!n) { 
                showAuthError("è¯·è¾“å…¥æ˜µç§°"); 
                return; 
            }
            if(p.length < 6) { 
                showAuthError("å¯†ç ä¸èƒ½å°‘äº 6 ä¸ªå­—ç¬¦"); 
                return; 
            }
            
            await loadUsers();
            
            const user = users.find(u => u.username === n);
            
            if (!user) {
                showAuthError("âŒ æœªæ³¨å†Œï¼Œè¯·å…ˆæ³¨å†Œ");
                return;
            }
            
            if (user.password !== p) {
                showAuthError("âŒ å¯†ç é”™è¯¯");
                return;
            }
            
            currentUser = n; 
            localStorage.setItem('sister_user', n); 
            updateUserUI();
            updateSignatureOwner();
            hideAuthError();
            showAuthError("âœ… ç™»å½•æˆåŠŸï¼");
            
            await loadData();
            
            setTimeout(hideAuthError, 3000);
        }

        function updateSignatureOwner() {
            const ownerSpan = document.getElementById('signatureOwner');
            if (currentUser) {
                ownerSpan.innerText = currentUser + ' çš„ç­¾å';
                ownerSpan.style.backgroundColor = 'rgba(212, 163, 115, 0.15)';
            } else {
                ownerSpan.innerText = 'æœªç™»å½•';
                ownerSpan.style.backgroundColor = '#f0f0f0';
            }
        }

        async function updateCloud(newData) {
            document.getElementById('status').innerText = "åŒæ­¥ä¸­...";
            try {
                await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN}`, { 
                    method: 'PUT', 
                    headers: { "Content-Type": "application/json", "X-Master-Key": CONFIG.KEY }, 
                    body: JSON.stringify(newData) 
                });
                await loadData();
            } catch (e) { }
        }

        async function loadData() {
            const icon = document.getElementById('refreshIcon'); icon.classList.add('rotating');
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN}/latest?v=${Date.now()}`, { headers: { "X-Master-Key": CONFIG.KEY }});
                const d = await res.json(); 
                
                // åº”ç”¨ç‰¹æ•ˆè®¾ç½®
                if (d.record.effect) {
                    effectSettings = d.record.effect;
                    document.documentElement.style.setProperty('--effect-color', effectSettings.color);
                    document.documentElement.style.setProperty('--effect-size', effectSettings.size + 'px');
                }
                
                applyStyles(d.record.settings); 
                render(d.record.notes || []);
                
                if (d.record.users) {
                    users = d.record.users;
                }
                
                if (d.record.signature) {
                    if (typeof d.record.signature === 'object') {
                        currentSignature = d.record.signature.content || "âœ¨ è¿™ä¸ªäººå¾ˆæ‡’ï¼Œè¿˜æ²¡æœ‰ç­¾å~";
                        signatureOwner = d.record.signature.owner || null;
                    } else {
                        currentSignature = d.record.signature;
                        signatureOwner = null;
                    }
                } else {
                    currentSignature = "âœ¨ è¿™ä¸ªäººå¾ˆæ‡’ï¼Œè¿˜æ²¡æœ‰ç­¾å~";
                    signatureOwner = null;
                }
                
                document.getElementById('signatureDisplay').innerText = currentSignature;
                document.getElementById('signatureInput').value = currentSignature;
                
                updateSignatureOwner();
                document.getElementById('status').innerText = "âœ¨ ç©ºé—´å·²åˆ·æ–°";
            } catch (e) { }
            setTimeout(() => icon.classList.remove('rotating'), 500);
        }

        function applyStyles(s) {
            if(!s) s = DEFAULT_S;
            const root = document.documentElement;
            root.style.setProperty('--main', s.theme);
            root.style.setProperty('--bg', s.bgCol);
            root.style.setProperty('--radius', s.radius + 'px');
            document.body.style.backgroundImage = s.bgImg ? `url(${s.bgImg})` : 'none';
            document.getElementById('verDisplay').innerText = s.currentVer;
            document.getElementById('noticeText').innerText = s.notice;
            document.getElementById('historyBox').innerHTML = (s.history || []).reverse().map(h => `<div style="font-size:11px; margin-bottom:5px; color:#666"><b>${h.ver}</b>: ${h.text}</div>`).join('');
        }

        // åˆ é™¤åŠ¨æ€
        async function deletePost(noteIdx) {
            if (!currentUser) {
                showAuthError("è¯·å…ˆç™»å½•");
                return;
            }
            
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN}/latest`, { 
                    headers: { "X-Master-Key": CONFIG.KEY }
                });
                const data = await res.json();
                let notes = data.record.notes || [];
                
                // æ£€æŸ¥åŠ¨æ€æ˜¯å¦å­˜åœ¨ä¸”å±äºå½“å‰ç”¨æˆ·
                if (!notes[noteIdx]) {
                    showAuthError("åŠ¨æ€ä¸å­˜åœ¨");
                    return;
                }
                
                const post = notes[noteIdx];
                if (post.author !== currentUser) {
                    showAuthError("åªèƒ½åˆ é™¤è‡ªå·±çš„åŠ¨æ€");
                    return;
                }
                
                // åˆ é™¤åŠ¨æ€
                notes.splice(noteIdx, 1);
                
                await updateCloud({ ...data.record, notes });
                showAuthError("âœ… åŠ¨æ€å·²åˆ é™¤");
                setTimeout(hideAuthError, 2000);
            } catch (e) {
                showAuthError("åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•");
            }
        }

        function render(notes) {
            const list = document.getElementById('msgList'); list.innerHTML = '';
            [...notes].map((n, i) => ({...n, rIdx: i})).reverse().forEach(note => {
                const div = document.createElement('div'); div.className = 'card';
                
                // æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦æ˜¯åŠ¨æ€ä½œè€…
                const isOwnPost = currentUser && note.author === currentUser;
                
                // æ„å»ºè¯„è®ºåˆ—è¡¨
                const comms = (note.comments || []).map((c, ci) => {
                    const isOwnComment = currentUser && c.user === currentUser;
                    
                    return `
                        <div class="comment-item">
                            <div class="comment-content">
                                <b>${c.user}:</b> ${c.content}
                            </div>
                            <div class="comment-actions">
                                <span class="comment-like" onclick="handleLike(${note.rIdx}, ${ci})">ğŸ‘ ${c.likes || 0}</span>
                                ${isOwnComment ? `<span class="comment-delete" onclick="showDeleteConfirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è¯„è®ºå—ï¼Ÿ', 'deleteComment(${note.rIdx}, ${ci})')" title="åˆ é™¤è¯„è®º">ğŸ—‘ï¸</span>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
                
                div.innerHTML = `
                    <div class="card-header">
                        <div class="card-header-left">
                            <span class="author-name">ğŸ‘¤ ${note.author}</span>
                            <span class="post-time">${note.time}</span>
                        </div>
                        ${isOwnPost ? `<span class="post-delete-btn" onclick="showDeleteConfirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡åŠ¨æ€å—ï¼Ÿ', 'deletePost(${note.rIdx})')" title="åˆ é™¤åŠ¨æ€">ğŸ—‘ï¸</span>` : ''}
                    </div>
                    <div class="post-text">${note.content}</div>
                    <div class="action-bar">
                        <div class="action-btn" onclick="handleLike(${note.rIdx})">ğŸ‘ ${note.likes || 0}</div>
                        <div class="action-btn" onclick="toggleComments(${note.rIdx})">ğŸ’¬ ${(note.comments || []).length}</div>
                    </div>
                    <div id="comments-${note.rIdx}" style="display:none; margin-top:8px">
                        ${comms}
                        <div class="comment-input-group">
                            <input type="text" id="comment-input-${note.rIdx}" class="comment-input-field" placeholder="å†™è¯„è®º...">
                            <button class="comment-send-btn" onclick="submitComment(${note.rIdx})">å‘</button>
                        </div>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        // åˆ é™¤è¯„è®ºå‡½æ•°
        async function deleteComment(noteIdx, commentIdx) {
            if (!currentUser) {
                showAuthError("è¯·å…ˆç™»å½•");
                return;
            }
            
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN}/latest`, { 
                    headers: { "X-Master-Key": CONFIG.KEY }
                });
                const data = await res.json();
                let notes = data.record.notes || [];
                
                // æ£€æŸ¥è¯„è®ºæ˜¯å¦å­˜åœ¨ä¸”å±äºå½“å‰ç”¨æˆ·
                if (!notes[noteIdx] || !notes[noteIdx].comments || !notes[noteIdx].comments[commentIdx]) {
                    showAuthError("è¯„è®ºä¸å­˜åœ¨");
                    return;
                }
                
                const comment = notes[noteIdx].comments[commentIdx];
                if (comment.user !== currentUser) {
                    showAuthError("åªèƒ½åˆ é™¤è‡ªå·±çš„è¯„è®º");
                    return;
                }
                
                // åˆ é™¤è¯„è®º
                notes[noteIdx].comments.splice(commentIdx, 1);
                
                await updateCloud({ ...data.record, notes });
                showAuthError("âœ… è¯„è®ºå·²åˆ é™¤");
                setTimeout(hideAuthError, 2000);
            } catch (e) {
                showAuthError("åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•");
            }
        }

        function toggleSignatureEdit() {
            if (!currentUser) {
                showAuthError('è¯·å…ˆç™»å½•åå†ç¼–è¾‘ç­¾å');
                return;
            }
            
            const display = document.getElementById('signatureDisplay');
            const editArea = document.getElementById('signatureEditArea');
            const input = document.getElementById('signatureInput');
            
            if (editArea.style.display === 'none' || !editArea.style.display) {
                display.style.display = 'none';
                editArea.style.display = 'block';
                input.value = currentSignature;
                input.focus();
            } else {
                display.style.display = 'block';
                editArea.style.display = 'none';
            }
        }

        function cancelSignatureEdit() {
            const display = document.getElementById('signatureDisplay');
            const editArea = document.getElementById('signatureEditArea');
            display.style.display = 'block';
            editArea.style.display = 'none';
        }

        async function saveSignature() {
            if (!currentUser) {
                showAuthError('è¯·å…ˆç™»å½•åå†ä¿å­˜ç­¾å');
                return;
            }
            
            const newSignature = document.getElementById('signatureInput').value.trim();
            if (!newSignature) {
                showAuthError('ç­¾åä¸èƒ½ä¸ºç©º');
                return;
            }

            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN}/latest`, { 
                    headers: { "X-Master-Key": CONFIG.KEY }
                });
                const data = await res.json();
                
                const signatureData = {
                    content: newSignature,
                    owner: currentUser,
                    updatedAt: new Date().toISOString()
                };
                
                const updatedRecord = {
                    ...data.record,
                    signature: signatureData
                };
                
                await updateCloud(updatedRecord);
                
                currentSignature = newSignature;
                signatureOwner = currentUser;
                document.getElementById('signatureDisplay').innerText = newSignature;
                updateSignatureOwner();
                cancelSignatureEdit();
                
                showAuthError("âœ¨ ç­¾åå·²ä¿å­˜åˆ°äº‘ç«¯");
                setTimeout(hideAuthError, 3000);
            } catch (e) {
                showAuthError('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        async function handleLike(nIdx, cIdx = null) {
            const res = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN}/latest`, { headers: { "X-Master-Key": CONFIG.KEY }});
            const data = await res.json(); let notes = data.record.notes || [];
            if (cIdx === null) notes[nIdx].likes = (notes[nIdx].likes || 0) + 1;
            else notes[nIdx].comments[cIdx].likes = (notes[nIdx].comments[cIdx].likes || 0) + 1;
            await updateCloud({ ...data.record, notes });
        }
        async function submitComment(idx) {
            if(!currentUser) {
                showAuthError("è¯·å…ˆç™»å½•");
                setTimeout(hideAuthError, 3000);
                return;
            }
            const val = document.getElementById(`comment-input-${idx}`).value.trim(); if(!val) return;
            const res = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN}/latest`, { headers: { "X-Master-Key": CONFIG.KEY }});
            const data = await res.json(); let notes = data.record.notes || [];
            if(!notes[idx].comments) notes[idx].comments = [];
            notes[idx].comments.push({ user: currentUser, content: val, likes: 0 });
            await updateCloud({ ...data.record, notes });
        }
        async function publish() {
            if(!currentUser) {
                showAuthError("è¯·å…ˆç™»å½•");
                setTimeout(hideAuthError, 3000);
                return;
            }
            const input = document.getElementById('msgInput'); if(!input.value.trim()) return;
            const res = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN}/latest`, { headers: { "X-Master-Key": CONFIG.KEY }});
            const data = await res.json(); let notes = data.record.notes || [];
            notes.push({ author: currentUser, content: input.value, time: new Date().toLocaleString('zh-CN'), comments: [], likes: 0 });
            input.value = ''; await updateCloud({ ...data.record, notes });
        }
        async function saveSettingsToCloud() {
            const res = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN}/latest`, { headers: { "X-Master-Key": CONFIG.KEY }});
            const data = await res.json(); const s = data.record.settings || DEFAULT_S;
            const v = document.getElementById('devVer').value; const n = document.getElementById('devNotice').value;
            if(v && n && v !== s.currentVer) { s.history.push({ ver: s.currentVer, text: s.notice }); s.currentVer = v; s.notice = n; }
            
            // è·å–ç‰¹æ•ˆè®¾ç½®
            const effectColor = document.getElementById('effectColor').value;
            const effectSize = parseInt(document.getElementById('effectSize').value);
            const effectShape = document.querySelector('.shape-option.selected')?.dataset.shape || 'circle';
            
            const upd = { 
                ...s, 
                theme: document.getElementById('themeColor').value, 
                bgCol: document.getElementById('bgColor').value, 
                bgImg: document.getElementById('bgUrl').value, 
                radius: document.getElementById('radiusRange').value 
            };
            
            const effectSettings = {
                color: effectColor,
                size: effectSize,
                shape: effectShape
            };
            
            const signatureData = currentSignature ? {
                content: currentSignature,
                owner: signatureOwner || currentUser || 'unknown',
                updatedAt: new Date().toISOString()
            } : null;
            
            await updateCloud({ 
                ...data.record, 
                settings: upd, 
                effect: effectSettings,
                signature: signatureData, 
                users: users 
            }); 
            closeAll();
        }
        async function resetSettings() { 
            if(confirm("é‡ç½®æ‰€æœ‰è£…ä¿®ï¼Ÿ")) { 
                const res = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.BIN}/latest`, { headers: { "X-Master-Key": CONFIG.KEY }}); 
                const data = await res.json(); 
                
                const signatureData = currentSignature ? {
                    content: currentSignature,
                    owner: signatureOwner || currentUser || 'unknown',
                    updatedAt: new Date().toISOString()
                } : null;
                
                await updateCloud({ 
                    ...data.record, 
                    settings: DEFAULT_S, 
                    effect: DEFAULT_S.effect,
                    signature: signatureData, 
                    users: users 
                }); 
                closeAll(); 
            } 
        }
        function toggleHistory() { const b = document.getElementById('historyBox'); b.style.display = b.style.display === 'block' ? 'none' : 'block'; }
        function toggleMenu() { document.getElementById('sidePanel').classList.toggle('open'); document.getElementById('overlay').style.display = 'block'; updateUserUI(); updateSignatureOwner(); }
        function closeAll() { document.getElementById('devModal').style.display = 'none'; document.getElementById('sidePanel').classList.remove('open'); document.getElementById('overlay').style.display = 'none'; document.getElementById('devAuthArea').style.display='none'; }
        function showDevAuth() { document.getElementById('devAuthArea').style.display='block'; }
        function verifyDevPass() { 
            if(document.getElementById('devPassInput').value === CONFIG.DEV_PASS) { 
                // åŠ è½½å½“å‰ç‰¹æ•ˆè®¾ç½®åˆ°å¼€å‘è€…é¢æ¿
                document.getElementById('effectColor').value = effectSettings.color;
                document.getElementById('effectSize').value = effectSettings.size;
                document.getElementById('effectSizeVal').innerText = effectSettings.size + 'px';
                
                // è®¾ç½®å½¢çŠ¶é€‰ä¸­çŠ¶æ€
                document.querySelectorAll('.shape-option').forEach(opt => {
                    if (opt.dataset.shape === effectSettings.shape) {
                        opt.classList.add('selected');
                    } else {
                        opt.classList.remove('selected');
                    }
                });
                
                updatePreview();
                document.getElementById('devModal').style.display = 'block'; 
            } else { 
                showAuthError("å£ä»¤é”™è¯¯"); 
            } 
        }
        function logout() { 
            localStorage.removeItem('sister_user'); 
            currentUser = null; 
            updateUserUI(); 
            updateSignatureOwner();
            hideAuthError();
            // é‡æ–°æ¸²æŸ“ä»¥æ›´æ–°åˆ é™¤æŒ‰é’®çŠ¶æ€
            loadData();
        }
        function updateUserUI() { 
            document.getElementById('userInfo').style.display = currentUser ? 'block' : 'none'; 
            document.getElementById('loginForm').style.display = currentUser ? 'none' : 'block'; 
            if(currentUser) document.getElementById('currUser').innerText = currentUser; 
        }
        function toggleComments(id) { 
            const el = document.getElementById(`comments-${id}`); 
            if (el) {
                el.style.display = el.style.display === 'block' ? 'none' : 'block'; 
            }
        }
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
        document.getElementById('radiusRange').oninput = function() { 
            document.getElementById('radiusVal').innerText = this.value + 'px'; 
        }
        
        document.getElementById('effectSize').oninput = function() {
            document.getElementById('effectSizeVal').innerText = this.value + 'px';
            updatePreview();
        }
        
        document.getElementById('effectColor').oninput = function() {
            updatePreview();
        }

        // é¡µé¢åŠ è½½
        window.onload = function() {
            loadData();
            updateSignatureOwner();
            initClickEffect();
        };
    </script>
</body>
</html>
